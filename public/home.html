<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>登入後頁面</title>

  <!-- SweetAlert2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">

  <link rel="stylesheet" href="/assets/css/app.css?v=20251106">
  <link rel="stylesheet" href="/assets/css/pages/home.css?v=20251106">
  
</head>
<body>
  
  <div class="app">
    <!-- 左側 Sidebar：帳號、登出、選單 -->
    <aside class="sidebar">
      <div class="account">
        <div>
          <div class="name" id="accountName">使用者名稱</div>
          <div class="role" id="accountRole">已登入</div>
        </div>
        <button id="logoutBtn" class="logout-btn">登出</button>
      </div>
      <ul class="nav">
        <li><button class="active" data-view="projects">專案進度</button></li>
        <li><button data-view="password">修改密碼</button></li>
      </ul>
    </aside>

    <!-- 右側 Main -->
    <main class="main">
      <!-- 頁面頂端標題列 -->
      <div class="topbar">
        <div class="title" id="pageTitle">所有專案進度</div>
      </div>

      <section class="content">
        <!-- 專案進度 View -->
        <div id="view-projects" class="view">
          <div class="card">

            <!-- 頁簽：進行中／已完成／全部 -->
            <div class="tabs-row" role="tablist" aria-label="專案篩選">
              <button class="tab" role="tab" data-filter="ongoing" aria-selected="true">進行中</button>
              <button class="tab" role="tab" data-filter="done" aria-selected="false">已完成</button>
              <button class="tab" role="tab" data-filter="all" aria-selected="false">全部</button>
            </div>

            <!-- 工具列：左狀態說明 + 右功能按鈕 -->
            <div class="card-topbar">

              <div class="legend" id="legendBar">
                <span class="pill"><i class="dot ok"></i>正常</span>
                <span class="pill"><i class="dot warn"></i>輕微超時</span>
                <span class="pill"><i class="dot danger"></i>超時7天</span>
                <span class="pill"><i class="dot done"></i>完成(上傳照片)</span>
              </div>
              <div class="function-buttons">
                <div id="unsavedNotice">
                  ⚠️ 尚未儲存修改，請記得按下「儲存」
                </div>
                <div>
                  <button id="addProjectBtn">
                    新增
                  </button>
                  <button id="saveBtn">
                    儲存
                  </button>
                </div>
              </div>
            </div>

            <!-- Grid 表頭 -->
            <div class="grid-header mode-default" id="gridHeader">
              <div>階段</div>
              <div>編號</div>
              <div>案名</div>
              <!--  8 欄位的表頭名稱
              <div>丈量</div>
              <div>案例分析</div>
              <div>平面放樣</div>
              <div>平面圖</div>
              <div>平面系統圖</div>
              <div>立面框體圖</div>
              <div>立面圖</div>
              <div>施工圖</div> -->
              <div class="action-head"></div>
              <div class="action-head"></div>
              <div class="action-head"></div>
            </div>

            <!-- 由程式動態注入 -->
            <div id="projectsGrid"></div>
          </div>
        </div>

        <!-- 修改密碼 View（保持原樣） -->
        <div id="view-password" class="view" style="display:none">
          <div class="card">
            <h2>修改密碼</h2>
            <p>請輸入舊密碼與新密碼。</p>
            <form id="pwdForm" onsubmit="return false;">
              <div>
                <label>
                  <div>舊密碼</div>
                  <input type="password" id="oldPwd" placeholder="輸入舊密碼" required>
                </label>
                <label>
                  <div>新密碼</div>
                  <input type="password" id="newPwd" placeholder="至少 6 碼" required minlength="6">
                </label>
                <label>
                  <div>再次輸入新密碼</div>
                  <input type="password" id="newPwd2" placeholder="再次輸入新密碼" required minlength="6">
                </label>
                <button id="savePwd">儲存</button>
                <div id="pwdMsg"></div>
              </div>
            </form>
          </div>
        </div>
      </section>

      <!-- 新增/編輯 共用 Modal  -->
      <div id="createModal" class="modal-overlay">
        <div class="modal">
          <div class="modal-header">
            <h3 class="modal-title">新增專案</h3>
            <button id="modalCloseBtn" class="modal-close" aria-label="關閉">&times;</button>
          </div>
          <div class="modal-body">
            <label>編號（必填）
              <input id="f_project_id" />
            </label>
            <label>案名（必填）
              <input id="f_name" />
            </label>
            <label>階段
              <select id="f_stage">
                <option value="0">等待</option>
                <option value="1">設計</option>
                <option value="2">施工</option>
              </select>
            </label>
            <label>開始日
              <input id="f_start_date" type="date" />
            </label>
            <label>工期天數
              <input id="f_estimated_days" type="number" min="0" step="1" />
            </label>
            <label>負責人
              <select id="f_responsible_user">
                <option value="">（未指派）</option>
              </select>
            </label>

            <div id="f_due_preview">預計完工日：—</div>

            <div class="modal-actions">
              <button id="f_cancel">取消</button>
              <button id="f_submit">送出</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>



  <!-- 上傳照片 Modal 與邏輯 -->
  <input id="uploadInput" type="file" accept="image/*" multiple style="display:none" />

  <div id="uploadModal">
    <div>
      <h3>上傳照片</h3>
      <p id="uploadHint"></p>
      <div>
        <button id="chooseFileBtn">選擇檔案</button>
        <button id="cancelUploadBtn">取消</button>
      </div>
      <div id="uploadStatus"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script type="module" src="/assets/js/pages/home.js?v=20251106"></script>

</body>
</html>